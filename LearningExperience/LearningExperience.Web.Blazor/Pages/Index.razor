@page "/"
@using LearningExperience.Core.Documents.Models
@using LearningExperience.Web.Blazor.Models
@inject HttpClient HttpClient

<div class="sidebar">
    <NavMenu OnBottomLevelReached="@LoadFileContentAsync" Documents="@documents" />
</div>

<div class="main">
    <div class="top-row px-4">
        <input class="form-control" type="search" placeholder="Поиск" aria-label="Search" asp-for="SearchText" style="width:100%">
    </div>

    <div class="content px-4">
        @((MarkupString)contentMarkup)
    </div>
</div>

@code
{
    DocumentsScheme<ClickableDocument> documentsScheme;

    List<ClickableDocument> documents;

    string contentMarkup = "<p>Выберите тему, чтобы увидеть ее содержимое</p>";

    protected override async Task OnInitializedAsync()
    {
        documentsScheme = await HttpClient.GetFromJsonAsync<DocumentsScheme<ClickableDocument>>($"https://localhost:5000/api/contentloader").ConfigureAwait(false);
        documents = documentsScheme.Documents;
    }

    private async Task LoadFileContentAsync(ClickableDocument document)
    {
        try
        {
            var decoded = Uri.EscapeUriString(document.Path);
            var response = await HttpClient.GetAsync($"https://localhost:5000/api/contentloader/{decoded}").ConfigureAwait(false);
            var content = await response.Content.ReadAsStringAsync().ConfigureAwait(false);
            contentMarkup = $"<h4>{document.Value}</h4><hr/>{Environment.NewLine}{content}";
        }
        catch (Exception e)
        {
            Console.WriteLine(e);
            throw;
        }
    }
}
