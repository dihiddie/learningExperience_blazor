<h6>Проблема</h6>
<p>Иногда нужно выполнить какую-либо задачу не «вот-прям-сию-секунду», а спустя некоторое время.<br>
Например, у нас есть скрипт, который время от времени обращается к какому-нибудь API, и, если ответ не изменился, «зысыпает» на некоторое время, потом «просыпается» и снова проверяет.<br>    
Или, к примеру, мы сохранили временный файл и нам нужно завести таймер, чтобы удалить файл по истечении указанного времени.
<br>
В подобных случаях нам нужен механизм, позволяющий создать в RabbitMQ отложенное сообщение</p>
<p>К сожалению, в самом RabbitMQ нет готового механизма для публикации отложенных сообщений. Сообщения, публикуемые отправителями в RabbitMQ, доставляются получателям мгновенно. Конечно, получатель может быть не подключен к RabbitMQ, в этом случае сообщение будет доставлено после подключения, но если получатель подключен — доставка сообщения производится сразу.
<br>Нельзя просто так опубликовать сообщение и сказать ему: «Полежи пока незаметно в уголочке, а через 10 минут вылезай и доставляйся получателю».
<br>Поэтому возникает задача — как, с помощью RabbitMQ, организовать отложенные сообщения?</p>

<h6>Решение</h6>
<p>Для этого придется сделать обходной маневр. Ключевая идея такая — если сообщение, отправленное в очередь, немедленно доставляется слушающему эту очередь получателю, значит, нужно отправить это сообщение в другую очередь! В общем и целом схема работы будет такая:</p>
<img src="https://habrastorage.org/getpro/habr/post_images/7d5/483/fd3/7d5483fd3a8e6cfeadafe576c6bf67fb.jpg">
<ol>
    <li>Создаем обменник, в который будут отправляться отложенные сообщения</li>
    <li>Создаем очередь, в которой будут храниться отложенные сообщения</li>
    <li>Делаем переплет между очередью и обменником</li>
    <li>Настраиваем очередь так, чтобы сообщения, полежав в ней некоторое заданное время, отправлялись в обычный обменник, для немедленной доставки получателю</li>
</ol>

<p>Источник: <a href="https://habr.com/ru/post/235505/">https://habr.com/ru/post/235505/</a>, <a href="https://habr.com/ru/post/235983/">https://habr.com/ru/post/235983/</a></p>